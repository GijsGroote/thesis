\input{mainmatter/hypothesis_graph/proposed_planning_algorithm}
 
\chapter{Proposed Robot Framework}%
\label{chap:h-graph_and_k-graph}
\textit{This chapter is dedicated to introducing and defining the proposed framework. The proposed framework consists of the \textbf{\acf{h-algorithm}}, the \textbf{\acf{h-graph}} and the \textbf{\acf{k-graph}}. The \ac{h-algorithm} acts on the \ac{h-graph} and is responsible for searching and executing action sequences to complete a specified task. \Cref{sec:h-graph} is dedicated to introducing and defining the \ac{h-graph}. Then the \ac{h-algorithm} is discussed and defined in \Cref{sec:h-algorithm}. The chapter finalizes with the \ac{k-graph} in \Cref{sec:k-graph}.\bs}

\section{Overview of the Proposed Framework}
\Cref{tikz:flowchart_proposed_method} presents a schematic overview of the interconnection of the \ac{k-graph}, \ac{h-algorithm} and the robot environment. The proposed framework could be augmented with a high-level planner that would transform a high-level task such as cleaning into the accepted format a list containing objects and corresponding target pose.\bs

\vspace{-0.4cm}
\begin{figure}[H] \centering
\begin{tikzpicture}[node distance = 1.5cm, auto]
    % Place nodes
    \node[draw=gray, rounded corners, inner sep=3ex, line width=7pt, fill=gray, fill opacity=0.4, minimum height=9.3cm, minimum width=5.8cm, yshift=2.50cm] (focusbox) {};
    \node[yshift=5.0cm, xshift=-1.5cm, align=left] at (focusbox) {\textbf{Thesis focus}};

   \node [outer sep=0cm] (environment) at (0,0)  {\includegraphics[width=4.6cm]{figures/proposed_method/example_environment.png}};

   \node [below, xshift=0.4cm, yshift=-.1cm, text width=5cm, align=left, outer sep=0cm] at (environment.north) {\textbf{Robot Environment}};

    \draw [myEvenLighterColor,
    rounded corners=0.3cm,
    line width=0.3cm]
    (environment.north west) --
    (environment.north east) --
    (environment.south east) --
    (environment.south west) -- cycle  ;

    \node [block,
    above of=environment,
    minimum height=1.5cm,
    minimum width=5cm,
    node distance=3.6cm,
    outer sep=0cm] (h-graph) {Hypothesis Algorithm};

    \node [block,
    above of=h-graph,
    node distance=2.5cm,
    minimum width=5cm,
    minimum height=1.5cm] (k-graph) {Knowledge Graph};

    \node [rectangle, draw,
    fill=myEvenLighterColor,
    text width=5em, text centered, rounded corners,
    right of=k-graph,
    minimum width=4cm,
    minimum height=1.5cm,
    node distance=7.5cm] (ontology) {Ontology};

    \node [rectangle, draw,
    fill=myEvenLighterColor,
    text width=5em, text centered, rounded corners,
    right of=h-graph,
    minimum width=4cm,
    minimum height=1.5cm,
    node distance=7.5cm] (planner) {High-level planner};

    % Draw edges
    \draw[-stealth] ([yshift=0.155cm, xshift=0.3 cm]environment.north) -- node [xshift=-.05cm, right] {\shortstack[]{sensor\\measurements}}([xshift=0.3 cm]h-graph.south) ;
    \draw[-stealth] ([xshift=-0.3 cm]h-graph.south) -- node [left] {robot input}([yshift=0.155cm, xshift=-0.3 cm]environment.north) ;
    \draw[-stealth] (planner.west) -- node [pos=0.37, above] {task}(h-graph.east);
    \draw[-stealth] ([xshift=-0.3cm]k-graph.south) -- node [left] {\shortstack[]{action\\suggestions}}([xshift= -0.3cm]h-graph.north) ;
    \draw[stealth-] ([xshift=0.3cm]k-graph.south) -- node [right] {\shortstack[]{action\\feedback}}([xshift= 0.3cm]h-graph.north) ;
    \draw[-stealth] (k-graph.east) -- node [xshift=-0.1cm, above, pos=0.63] {\shortstack[]{environment\\knowledge}}(ontology.west);
    \draw[stealth-] ([xshift=0.3cm]ontology.south) -- node [right] {\shortstack[]{query}}([xshift=0.3cm]planner.north);
    \draw[-stealth] ([xshift=-0.3cm]ontology.south) -- node [left] {\shortstack[]{output}}([xshift=-0.3cm]planner.north);
    \draw[stealth-] (planner.south) |- ++ (2,-1) node[near end, above] {\shortstack[]{High-level\\task}};
    \end{tikzpicture}
\caption{Flowchart representation of the proposed robot framework.}%
\label{tikz:flowchart_proposed_method}
\end{figure}

The block containing the \ac{h-algorithm} in \Cref{tikz:flowchart_proposed_method} orchestrates the generation and execution of action sequences. In doing so, it creates a \ac{h-graph}, first the \ac{h-graph} is introduced and discussed, then the \ac{h-algorithm} is introduced and discussed.\bs

\input{mainmatter/hypothesis_graph/hypothesis_graph}
\input{mainmatter/hypothesis_graph/h-algorithm}
\input{mainmatter/knowledge_graph/knowledge_graph}

What by now hopefully became clear to the reader is that the \ac{h-algorithm} autonomously searches for hypotheses in the \ac{h-graph} to solve a task, one subtask at a time. The \ac{h-algorithm} switches between the search and execution loop. Switching from the search loop toward the execution loop when a hypothesis is found and switching back when a hypothesis is completed, or a fault is detected.\bs

The limited number of possible edge parameterization (every combination of a system identification method with a compatible control method) guarantees that the robot tries to complete a subtask. However, it concludes that it cannot complete a subtask if all possible edges have failed.\bs

This thesis proposes to combine the three topics (one, learning object dynamics, two, the \ac{NAMO} problem, and three, nonprehensile push manipulation to target pose). The \ac{h-algorithm} can solve \ac{NAMO} problems because the robot can drive toward target poses even if reaching such a pose requires objects to be moved first. The proposed algorithm learns to classify objects by updating the object's class from unknown to movable or unmovable. The \ac{h-algorithm} can push objects to target poses by identifying a system model and then pushing the object toward its target pose. However, the system model that system identification yields is of short use because it is only given to the corresponding action edge.\bs

% This chapter has terminology that is conveniently grouped in \Cref{table:proposed_method_terminology}.\bs

% \noindent
% \begin{table}[H]
% \caption{The proposed-framework-related terminology is juxtaposed in the left column\\alongside its corresponding description in the right column.}%
% \label{table:proposed_method_terminology}
% \centering
% \begin{tabular}%
%   {>{\raggedright\arraybackslash}p{0.23\textwidth}%
%    >{\raggedright\arraybackslash}p{0.67\textwidth}}
% Task:   &  Tuple of objects and corresponding target configurations.\\[-0.3cm]
%         & \[\textrm{task} = \gls{task} = \left\langle \gls{Obj}_{\mathit{task}}, C_{\mathit{targets}} \right\rangle\]\\[-0.3cm]
% Subtask:& A single object and a single target configuration.\\[-0.3cm]
%         & \[\textrm{subtask} = \gls{subtask}= \left\langle \mathit{obj}_{\mathit{subtask}}, \gls{c}_{\mathit{target}} \right\rangle\]\\[-0.3cm]
% Object Class & Classification assigned to an object.\\[-0.3cm]
%              & \[\gls{objectClass} = \textrm{Unknown}\vee \textrm{Obstacle}\vee \textrm{Movable}\]\\[-0.3cm]
% Node:   & Three type of nodes exist, the object node in the \acs{h-graph} and the center- and side node in the \acs{k-graph}. The object node represents an object at a certain pose. The center node represents an object, the side node acts as a placeholder.\\
% Node Status:& Only an object node bears a status, which indicates if a object node could be reached over a sequence of edges from a start node. \\[-0.3cm]
%             & \[\gls{nodeStatus} = \mathrm{Initialised} \vee \mathrm{Completed} \vee \mathrm{Unfeasible} \]\\[-0.3cm]
% Edge:   & Edge connecting a node to another node in the \acs{h-graph} or \ac{k-graph}.\\[-0.3cm]
% Edge Status:& Status of an edge indicates at which stage of its lifetime the edge currently is. For an identification edge, eleborate information can be found in \Cref{tikz:status_identification_edge}, for a action edge eleborate information can be found in \Cref{tikz:status_action_edge}.\\
% Non-Failed Status:& Node- or edge status other than FAILED.\\
% Hypothesis:& Sequence of successive edges in the \ac{h-graph}, an idea to put an object at its target configuration. If executed and completed, a subtask is completed.\\[-0.3cm]
%            & \[\textrm{hypothesis} = \gls{hypothesis} = \left[\ \gls{edge}_{1}, \gls{edge}_{2}, \gls{edge}_{3}, \dots \gls{edge}_{m} \right]\,  m>0\]\\[-0.3cm]
% Hypothesis Algorithm:& Graph-based algorithm that searches for hypothesis in the \ac{h-graph} to complete subtasks, eventually completing a task.\\
% Hypothesis Graph:& Collection of nodes and edges. For every subtask, a start and target node exist in the \ac{h-graph}, and the \ac{h-algorithm} searches for a path through nodes and edges to connect the start to the target node.\\[-0.3cm]
%                  & \[\textrm{\ac{h-graph}} = \gls{h-graph} = \left\langle \gls{nodesH}, \gls{edgesH} \right\rangle \]\\[-0.3cm]
% Knowledge Graph:& Collection of nodes and edges. The \ac{k-graph} acts as a knowledge base and can be queried for an action suggestion.\\[-0.3cm]
%                 & \[\textrm{\ac{k-graph}} = \gls{k-graph} = \left\langle \gls{nodesK}, \gls{edgesK} \right\rangle \]\\[-0.3cm]
% \end{tabular}
% \end{table}

