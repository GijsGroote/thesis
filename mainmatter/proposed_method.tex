\chapter{The Hypothesis and Knowledge graph}%
\label{chap:hgraph_and_kgraph}

\textit{This chapter is dedicated to introducing and defining the proposed method, the proposed method consist of the \acl{halgorithm}, the \acl{hgraph} and the \acl{kgraph}. The \textbf{\acl{halgorithm}} acts on the \textbf{\acl{hgraph}} is responsible for searching the joint configuration space for action sequences to complete a specified task, \cref{subsec:hgraph_definition} is dedicated to the \ac{halgorithm} and the \ac{hgraph}. The \ac{halgorithm} additionally is responsible for collecting new knowledge of the environment. Gathered new environment knowledge is stored in the \textbf{\acl{kgraph}}, defined in \cref{subsec:kgraph_definition}. Collected knowledge is rated and ordered from \quotes{good} to \quotes{bad} experiences using various metrics. Such an ordering within collected knowledge makes the \ac{kgraph} a knowledge base that can be queried for action suggestions. \Cref{tikz:flowchart_proposed_method} presents a schematic overview of the interconnection of the knowledge-, hypothesis graph and the robot environment. A more in depth analysis of the hypothesis graph is given in~\cref{sec:hgraph}, and for the knowledge graph in~\cref{sec:kgraph}.}

\vspace{-0.2cm}
\begin{figure}[H] \centering
\begin{tikzpicture}[node distance = 2cm, auto]
    % Place nodes
    \node[draw=gray, rounded corners, inner sep=3ex, line width=7pt, fill=gray, fill opacity=0.4, minimum height=11.0cm, minimum width=5.8cm, yshift=3.25cm] (focusbox) {}; 
    \node[yshift=5.8cm, xshift=-1.5cm, align=left] at (focusbox) {\textbf{Thesis focus}};
   
   \node [outer sep=0cm] (environment) at (0,0)  {\includegraphics[width=4.6cm]{figures/example_environment.png}}; 

   \node [below, xshift=0.4cm, yshift=-.1cm, text width=5cm, align=left, outer sep=0cm] at (environment.north) {\textbf{Robot Environement}};
   
    \draw [myEvenLighterColor,
    rounded corners=0.3cm, 
    line width=0.3cm]  
    (environment.north west) -- 
    (environment.north east) --
    (environment.south east) --
    (environment.south west) -- cycle  ;
    
    \node [block,
    above of=environment,
    minimum height=2cm,
    minimum width=5cm,
    node distance=4.1cm,
    outer sep=0cm] (hgraph) {Hypothesis Algorithm};
   
    \node [block, 
    above of=hgraph, 
    node distance=3.3cm, 
    minimum width=5cm,
    minimum height=2.0cm] (kgraph) {Knowledge Graph};
      
    \node [rectangle, draw, 
    fill=myEvenLighterColor, 
    text width=5em, text centered, rounded corners, 
    right of=kgraph, 
    minimum width=4cm,
    minimum height=2cm,
    node distance=7.2cm] (ontology) {Ontology};
     
    \node [rectangle, draw, 
    fill=myEvenLighterColor, 
    text width=5em, text centered, rounded corners, 
    right of=hgraph, 
    minimum width=4cm,
    minimum height=2cm,
    node distance=7.2cm] (planner) {High-level planner};
    
    % Draw edges
    \draw[-stealth] ([yshift=0.155cm, xshift=0.4 cm]environment.north) -- node [xshift=-.05cm, right] {\shortstack[]{sensor\\measurements}}([xshift=0.4 cm]hgraph.south) ;
    \draw[-stealth] ([xshift=-0.4 cm]hgraph.south) -- node [left] {robot input}([yshift=0.155cm, xshift=-0.4 cm]environment.north) ;
    \draw[-stealth] (planner.west) -- node [pos=0.37, above] {task}(hgraph.east);
    \draw[-stealth] ([xshift=-0.4cm]kgraph.south) -- node [left] {\shortstack[]{action\\suggestions}}([xshift= -0.4cm]hgraph.north) ;
    \draw[stealth-] ([xshift=0.4cm]kgraph.south) -- node [right] {\shortstack[]{action\\feedback}}([xshift= 0.4cm]hgraph.north) ;
    \draw[-stealth] (kgraph.east) -- node [xshift=-0.1cm, above, pos=0.63] {\shortstack[]{environment\\knowledge}}(ontology.west);
    \draw[stealth-] ([xshift=0.4cm]ontology.south) -- node [right] {\shortstack[]{query}}([xshift=0.4cm]planner.north);
    \draw[-stealth] ([xshift=-0.4cm]ontology.south) -- node [left] {\shortstack[]{output}}([xshift=-0.4cm]planner.north);
    \draw[stealth-] (planner.south) |- ++ (2,-1) node[near end, above] {\shortstack[]{High-level\\task}};
    \end{tikzpicture}
\caption{Flowchart representation of the proposed method.}%
\label{tikz:flowchart_proposed_method}
\end{figure}

As the above figure shows, the thesis focus could be augmented with an ontology and high-level planner. Such an augmentation would create a framework capable of completing high-level tasks such as cleaning or exploring.\bs 

This chapter has terminology that is conveniently grouped in the following table.

\begin{table}[H]
\centering
\begin{tabular}[t]{l p{10cm}}
Task:   &  Tuple of objects and target configurations.\\
        & $\text{task} = \gls{task} = \left\langle \gls{objSet}_{\mathit{task}}, C_{\mathit{targets}} \right\rangle$\\
Subtask:& A single object, and a single target configuration.\\
        & $\text{subtask} = \gls{subtask}= \left\langle \mathit{obj}_{\mathit{subtask}}, \gls{c}_{\mathit{target}} \right\rangle$\\
Object Class & Classification assigned to an object.\\
             & $\gls{objectClass} = \textrm{Unknown}\vee \textrm{Obstacle}\vee \textrm{Movable}$\\
Node Status:& Status of a node indicates if a node is initialised, the \ac{halgorithm} was able to bring the object to the configuration or whether the \ac{halgorithm} fails to bring the object to its configuration.\\
            & \[\gls{nodeStatus} = \mathrm{Initialised} \vee \mathrm{Completed} \vee \mathrm{Failed} \]\\
Node:   & A node in the \acs{hgraph}, represents an object in a configuration with reachability indicated with a node status.\\
        & $\textrm{node} = \gls{node} = \left\langle \textrm{status}, \mathit{obj}, c \right\rangle$\\
Edge Status:& Status of a edge, elaborate information on the statuses can be found in \cref{tikz:status_action_edge}.\\
            & \[\gls{edgeStatus} = \mathrm{Initialised} \vee \mathrm{Path Exists} \vee \mathrm{System Model} \vee \] \[\mathrm{Path Planned} \vee \mathrm{Executing} \vee \mathrm{Completed} \vee \mathrm{Failed}\]\\
Edge:   & Edge connecting a node to another node in the \acs{hgraph} or \ac{kgraph}.\\
        & $ \textrm{edge} = \gls{edge} = \left\langle \textrm{status}, id_{\mathit{from}}, id_{\mathit{to}}, \textrm{verb}, \textrm{controller},\textrm{dynamic model}, \textrm{path}\right\rangle$\\
Hypothesis:& Sequence of successive edges in the \ac{hgraph}, an idea to put a object at it's target configuration. If executed and successfully completed, a subtask is completed.\\
           & $ \textrm{hypothesis} = \gls{hypothesis} = \left[\ \gls{edge}_{1}, \gls{edge}_{2}, \gls{edge}_{3}, \dots \gls{edge}_{m} \right]\ $, \hspace{0.5cm} $m>0$\\
Hypothesis Algorithm:& Graph based algorithm that searches for hypothesis in the \ac{hgraph} to complete subtasks eventually completing a task.\\
Hypothesis Graph:& Collection of nodes and edges. For every subtask a start and target node exist in the \ac{hgraph}, the \ac{halgorithm} searches for a path through nodes and edges to connect start to target node.\\
        & $ \textrm{\ac{hgraph}} = \gls{hgraph} = \left\langle \gls{nodesG}, \gls{edgesG} \right\rangle $\\
Knowledge Graph:& Collection of nodes and edges.  The \ac{kgraph} acts as a knowledge base and can be queried for an action suggestion.\\
        & $ \textrm{KGraph} = \gls{kgraph} = \left\langle \gls{nodesG}, \gls{edgesG} \right\rangle $\\
\end{tabular}
\caption{Terminology of terms used}
\label{table:proposed_method_terminology}
\end{table}

\input{mainmatter/hypothesis_graph/hypothesis_graph}
\input{mainmatter/knowledge_graph/knowledge_graph}

