\chapter{The Hypothesis and Knowledge graph}%
\label{chap:hgraph_and_kgraph}

\textit{This chapter is dedicated to introducing and defining the proposed method. The \textbf{hypothesis graph}, defined is \cref{sec:hgraph_definition} is responsible for searching the joint configuration space for action sequences that complete a given task. The \ac{hgraph} additionally is responsible for collecting new knowledge of the environment. The \textbf{knowledge graph}, defined is \cref{subsec:kgraph_definition} is responsible for storing collected knowledge. Collected knowledge is rated using various metrics to created an ordering within collected knowledge. The \ac{kgraph} is queried for action suggestions when a new action sequence is generated by the \ac{kgraph}. \Cref{tikz:flowchart_proposed_method} presents a schematic overview of the interconnection of the knowledge-, hypothesis graph and the robot environment. A more in depth analysis of the hypothesis graph is given in~\cref{sec:hgraph}, and for the knowledge graph in~\cref{sec:kgraph}.}

\begin{figure}[H] \centering
\begin{tikzpicture}[node distance = 2cm, auto]
    % Place nodes
    \node[draw=gray, rounded corners, inner sep=3ex, line width=7pt, fill=gray, fill opacity=0.4, minimum height=11.0cm, minimum width=5.8cm, yshift=3.25cm] (focusbox) {}; 
    \node[yshift=5.8cm, xshift=-1.5cm, align=left] at (focusbox) {\textbf{Thesis focus}};
   
   \node [outer sep=0cm] (environment) at (0,0)  {\includegraphics[width=4.6cm]{figures/example_environment.png}}; 

   \node [below, xshift=0.4cm, yshift=-.1cm, text width=5cm, align=left, outer sep=0cm] at (environment.north) {\textbf{Robot Environement}};
   
    \draw [myEvenLighterColor,
    rounded corners=0.3cm, 
    line width=0.3cm]  
    (environment.north west) -- 
    (environment.north east) --
    (environment.south east) --
    (environment.south west) -- cycle  ;
    
    \node [block,
    above of=environment,
    minimum height=2cm,
    minimum width=5cm,
    node distance=4.1cm,
    outer sep=0cm] (hgraph) {Hypothesis Algorithm};
   
    \node [block, 
    above of=hgraph, 
    node distance=3.3cm, 
    minimum width=5cm,
    minimum height=2.0cm] (kgraph) {Knowledge Graph};
      
    \node [rectangle, draw, 
    fill=myEvenLighterColor, 
    text width=5em, text centered, rounded corners, 
    right of=kgraph, 
    minimum width=4cm,
    minimum height=2cm,
    node distance=7.2cm] (ontology) {Ontology};
     
    \node [rectangle, draw, 
    fill=myEvenLighterColor, 
    text width=5em, text centered, rounded corners, 
    right of=hgraph, 
    minimum width=4cm,
    minimum height=2cm,
    node distance=7.2cm] (planner) {High-level planner};
    
    % Draw edges
    \draw[-stealth] ([yshift=0.155cm, xshift=0.4 cm]environment.north) -- node [xshift=-.05cm, right] {\shortstack[]{sensor\\measurements}}([xshift=0.4 cm]hgraph.south) ;
    \draw[-stealth] ([xshift=-0.4 cm]hgraph.south) -- node [left] {robot input}([yshift=0.155cm, xshift=-0.4 cm]environment.north) ;
    \draw[-stealth] (planner.west) -- node [pos=0.37, above] {task}(hgraph.east);
    \draw[-stealth] ([xshift=-0.4cm]kgraph.south) -- node [left] {\shortstack[]{action\\suggestions}}([xshift= -0.4cm]hgraph.north) ;
    \draw[stealth-] ([xshift=0.4cm]kgraph.south) -- node [right] {\shortstack[]{action\\feedback}}([xshift= 0.4cm]hgraph.north) ;
    \draw[-stealth] (kgraph.east) -- node [xshift=-0.1cm, above, pos=0.63] {\shortstack[]{environment\\knowledge}}(ontology.west);
    \draw[stealth-] ([xshift=0.4cm]ontology.south) -- node [right] {\shortstack[]{query}}([xshift=0.4cm]planner.north);
    \draw[-stealth] ([xshift=-0.4cm]ontology.south) -- node [left] {\shortstack[]{output}}([xshift=-0.4cm]planner.north);
    \draw[stealth-] (planner.south) |- ++ (2,-1) node[near end, above] {\shortstack[]{High-level\\task}};
    \end{tikzpicture}
\caption{Simplified flowchart representation of the proposed method. The thesis focus could be augmented with an ontology and high-level planner as displayed. Such an augmentation would create a framework capable of completing high-level tasks such as cleaning or exploring.}%
\label{tikz:flowchart_proposed_method}
\end{figure}

a task consists of objects with corresponding target states. A summary of the terminology (e.g.~task) used is presented and eleborated on in \cref{table:proposed_method_terminology}.
This chapter uses some terms that might confuse the reader, the following table conviently groups the terminology used.
\begin{table}[ht]
\centering
\begin{tabular}[t]{l p{10cm}}
Task:   & Tuple of objects and target states.\\
        & $\text{task} = \left\langle Obst_{task}, S_{targets} \right\rangle$\\
Object Class & Classification assigned to an object, initially all objects are placed in the $Unknown$ class, and objects class can be updated to either the $Obstacle$ or the $Movable$ class\\
        & $\text{object class} = (Unknown, Obstacle, Movable)$\\
Subtask:& A single object, and a single target state.\\
        & $\text{subtask} = \left\langle obst_{subtask}, s_{target} \right\rangle$\\
Node:   & Tuple of an status, object and a state. A node in the \acs{hgraph}, represents an object being at a state in the robot environment. Status of a node can be either $Initialised$, $Completed$ or $Failed$.\\
        & $\text{node} = \left\langle \textrm{status}, Obst, s_{} \right\rangle$\\
Edge:   & Edge from a node to another node in the \acs{hgraph} or \ac{kgraph}, represent movement by the robot in the robot environment.\\
        & $ \text{edge} = \left\langle \textrm{status}, id_{from}, id_{to}, \textrm{verb}, \textrm{controller},\textrm{dynamic model}, \textrm{path}\right\rangle$\\
        & where status is the status of the edge eleborated on in \cref{tikz:status_identification_edge}, see \cref{subsec:hgraph_definition} for information on the edge arguments.\\
Hypothesis:& Sequence of succesive edges in the \ac{hgraph}, an idea to put a object at it's target state. If executed in order without any error, completes a subtask.\\
        & $ \text{hyp} = \left\langle edge_{1}, edge_{2}, edge_{3}, \dots edge_{m} \right\rangle $\\
Hypothesis Graph:& Collection of nodes and edges. A path of edges from a starting node to a target node is an hypothesis. If every subtask has an succesfully completed accompanying hypothesis, the \ac{hgraph} completed the task\\
        & $ \text{HGraph} = \left\langle V, E \right\rangle $\\
Knowledge Graph:& Collection of nodes and edges. If an edge stoppes executing, feedback on the performance of the edge is stored in the \ac{kgraph}\\
        & $ \text{KGraph} = \left\langle V, E \right\rangle $\\
\end{tabular}
\caption{Terminology of terms used}
\label{table:proposed_method_terminology}
\end{table}

\input{mainmatter/hypothesis_graph/hypothesis_graph}
\input{mainmatter/knowledge_graph/knowledge_graph}

